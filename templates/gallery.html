<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>图库</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 2rem; }
      .container { max-width: 1100px; margin: 0 auto; }
      .nav a { margin-right: .75rem; }
      .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 1rem; }
      .item { border: 1px solid #ddd; border-radius: 8px; padding: .5rem; }
      .thumb { width: 100%; height: 180px; object-fit: cover; border-radius: 6px; }
      .meta { font-size: .85rem; color: #666; margin-top: .25rem; }
      .link { font-size: .85rem; word-break: break-all; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="nav">
        <a href="/">上传</a>
        <a href="/gallery">刷新</a>
      </div>
      {% with messages = get_flashed_messages() %}
      {% if messages %}
      <ul style="padding: .5rem 1rem; background:#f6f6f6; border:1px solid #ddd; border-radius:6px; color:#333;">
        {% for m in messages %}<li>{{ m }}</li>{% endfor %}
      </ul>
      {% endif %}
      {% endwith %}
      <h2>图库</h2>
      <div class="grid">
        {% for it in items %}
        <div class="item">
          <a href="{{ it.url }}" target="_blank"><img class="thumb" src="{{ it.url }}" alt="{{ it.filename }}" loading="lazy"></a>
          <div class="meta">
            {{ it.filename }} · {{ it.size }}B
            {% if it.original_size is defined and it.original_size != it.size %}
              (原始 {{ it.original_size }}B)
            {% endif %}
            {% if it.optimized %}
              · 已压缩
            {% else %}
              · 未压缩
            {% endif %}
            {% if it.converted is defined and it.converted %}
              · 已转 PNG (原格式 {{ it.original_ext|default('未知')|upper }})
            {% else %}
              · 未转换
            {% endif %}
          </div>
          <div class="link"><a href="/links/{{ it.id }}">/links/{{ it.id }}</a></div>
          <form action="/delete/{{ it.id }}" method="post" onsubmit="return confirm('确认删除该图片？此操作不可恢复');" style="margin-top:.5rem;">
            {% if delete_token %}
            <input type="hidden" name="token" value="{{ delete_token }}">
            {% endif %}
            <button type="submit" style="padding:.35rem .6rem;border:1px solid #d33;border-radius:6px;background:#fff;color:#d33;cursor:pointer;">删除</button>
          </form>
        </div>
        {% else %}
        <p>暂无图片，先去 <a href="/">上传</a> 吧。</p>
        {% endfor %}
      </div>
    </div>
  </body>
  </html>
